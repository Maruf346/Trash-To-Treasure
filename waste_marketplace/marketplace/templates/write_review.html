{% load static %}
{% include "header.html" %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Write Review - TrashToTreasure</title>
    <link rel="stylesheet" href="{% static 'css/buyer_profile.css' %}">
    <link rel="stylesheet" href="{% static 'css/write_review.css' %}">
</head>
<body>

<!-- Banner Section -->
<section class="product-banner">
    <h2>Write Review</h2>
    <p><a href="/ ">Home</a> &gt; Write Review for Order #{{ order.id }}</p>
</section>

<div class="review-container">
  <h2>Write Reviews for Order #{{ order.id }}</h2>
  <form method="post">
    {% csrf_token %}

    {% for product in reviewable_items %}
        <div class="review-block">
            <h3>
                {% if product|model_name == 'upcycledproduct' %}
                    <a href="{% url 'upcycled_product_details' slug=product.slug %}">
                        {{ product.product_name }}
                    </a>
                {% elif product|model_name == 'trashitem' %}
                    <a href="{% url 'trash_item_details' slug=product.slug %}">
                        {{ product.material_name }}
                    </a>
                {% else %}
                    Unknown Item
                {% endif %}
            </h3>
            
        <div class="stars" data-index="{{ forloop.counter0 }}">
            {% for i in "12345" %}
                <span class="star" data-value="{{ forloop.counter|add:"-1" }}">{{ forloop.counter|add:"-1" }}</span>
            {% endfor %}
            <input type="hidden" name="rating_{{ forloop.counter0 }}" id="rating_{{ forloop.counter0 }}">
        </div>

        <textarea name="comment_{{ forloop.counter0 }}"
                  placeholder="Write your comments (optional)"></textarea>
      </div>
    {% endfor %}

    {% if driver_pending %}
      <div class="review-block">
        <h3>Delivery by {{ driver.name }}</h3>
        <div class="stars">
          <label><input type="radio" name="rating_driver" value="1">★</label>
          <label><input type="radio" name="rating_driver" value="2">★</label>
          <label><input type="radio" name="rating_driver" value="3">★</label>
          <label><input type="radio" name="rating_driver" value="4">★</label>
          <label><input type="radio" name="rating_driver" value="5">★</label>
        </div>
        <textarea name="comment_driver"
                  placeholder="Comment on delivery (optional)"></textarea>
      </div>
    {% endif %}

    <button type="submit" class="submit-review-btn">Submit Reviews</button>
  </form>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const starBlocks = document.querySelectorAll('.stars');
    
        starBlocks.forEach(block => {
            const stars = block.querySelectorAll('.star');
            const hiddenInput = block.querySelector('input[type="hidden"]');
    
            stars.forEach((star, index) => {
                star.addEventListener('mouseover', function() {
                    stars.forEach((s, i) => {
                        s.classList.toggle('hovered', i <= index);
                    });
                });
    
                star.addEventListener('mouseout', function() {
                    stars.forEach((s) => s.classList.remove('hovered'));
                });
    
                star.addEventListener('click', function() {
                    hiddenInput.value = star.getAttribute('data-value');
                    stars.forEach((s, i) => {
                        s.classList.toggle('selected', i <= index);
                    });
                });
            });
        });
    });
    </script>
    

</body>
</html>

{% include "footer.html" %}
